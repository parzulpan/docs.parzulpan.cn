<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML5 Web存储</title>
</head>
<body>
<!--早些时候,本地存储使用的是cookie。-->
<!--但是Web存储需要更加的安全与快速. 这些数据不会被保存在服务器上，但是这些数据只用于用户请求网站数据上.它也可以存储大量的数据，而不影响网站的性能.-->
<!--数据以键/值对存在, web网页的数据只允许该网页访问使用.-->

<!--客户端存储数据的两个对象:-->
<!--1. localStorage &#45;&#45; 用于长久保存整个网站的数据,保存的数据没有过期时间,直到手动去除-->
<!--2. sessionStorage &#45;&#45; 用于临时保存同一窗口(或标签页)的数据,在关闭窗口(或标签页)之后数据将被删除-->

<div id="result"></div>
<div id="result1"></div>
<div style="border:2px dashed #ccc; width:320px; text-align:center; ">
    <label for="keyName">别名(keyName):  </label>
    <input type="text" id="keyName" class="text"/>
    <br/>
    <label for="siteName">网站名(siteName): </label>
    <input type="text" id="siteName" class="text"/>
    <br/>
    <label for="url">网站(url):    </label>
    <input type="text" id="url" class="text"/>
    <br/>
    <input type="button" onclick="save()" value="新增记录"/>
    <hr/>
    <label for="searchKeyName">查找别名(searchKeyName):  </label>
    <input type="text" id="searchKeyName" class="text"/>
    <input type="button" onclick="search()" value="查找记录"/>
    <p id="searchResult">结果: </p>
    <br/>
</div>
<div id="list"></div>

<script>
    if(typeof(Storage) !== "undefined") {
        // 创建一个键值对
        localStorage.description="learn web storage";
        // 检索键值
        document.getElementById("result").innerHTML = "描述: " + localStorage.description;
        // API
        // 保存数据：localStorage.setItem(key,value);
        // 读取数据：localStorage.getItem(key);
        // 删除单个数据：localStorage.removeItem(key);
        // 删除所有数据：localStorage.clear();
        // 得到某个索引的key：localStorage.key(index);
    } else {
        document.getElementById("result").innerHTML = "对不起，您的浏览器不支持 web 存储。";
    }

    if(typeof(Storage) !== "undefined") {
        if(sessionStorage.clickcnt) {
            sessionStorage.clickcnt = Number(sessionStorage.clickcnt) + 1;
        } else {
            sessionStorage.clickcnt = 1;
        }

        document.getElementById("result1").innerHTML = "在这个会话中你已经点击了该按钮 " + sessionStorage.clickcnt;

    } else {
        document.getElementById("result").innerHTML = "对不起，您的浏览器不支持 web 存储。";
    }

    // 保存数据
    function save() {
        let site = new Map;
        site.keyName = document.getElementById("keyName").value;
        site.siteName = document.getElementById("siteName").value;
        site.url = document.getElementById("url").value;
        let str = JSON.stringify(site);
        localStorage.setItem(site.keyName, str);
        alert(`保存成功: ${site.keyName}`);
    }

    // 查找数据
    function search() {
        let searchKeyName = document.getElementById("searchKeyName").value;
        let str = localStorage.getItem(searchKeyName);
        let searchResult = document.getElementById("searchResult");
        let site = JSON.parse(str);
        searchResult.innerHTML = `${searchKeyName}的网站名是: ${site.siteName}, 网址是: ${site.url}`;
    }

    // 将所有存储在localStorage中的对象提取出来,并展现到界面上,确保存储的keyName对应的值为转换对象,否则JSON.parse会报错
    function loadAll(){
        let list = document.getElementById("list");
        if(localStorage.length>0){
            let result = "<table border='1'>";
            result += "<tr><td>别名</td><td>网站名</td><td>网址</td></tr>";
            for(let i = 0; i < localStorage.length; i++){
                let keyName = localStorage.key(i);
                let str = localStorage.getItem(keyName);
                let site = JSON.parse(str);
                result += "<tr><td>" + site.keyName + "</td><td>" + site.siteName + "</td><td>" + site.url + "</td></tr>";
            }
            result += "</table>";
            list.innerHTML = result;
        }else{
            list.innerHTML = "数据为空...";
        }
    }


</script>



</body>
</html>