# 高频面试题：存储引擎

## MyISAM和InnoDB的区别

* MyISAM是非事务安全型的，而InnoDB是事务安全型的。
* MyISAM锁的粒度是表级，而InnoDB支持行级锁定。
* MyISAM支持全文索引，而InnoDB不支持全文索引。
* MyISAM表保存成文件形式，在跨平台的数据转移中使用它存储会省去不少的麻烦。
* InnoDB表比MyISAM表更安全，可以保证数据不丢失的情况下，切换到非事务表到事物表。

应用场景分别为：

* MyISAM管理非事务表，它提供高速存储和检索，以及全文索引能力。如果应用需要执行大量的SELECT查询，使用它比较好。
* InnoDB用于管理事务表，有比较多的特性，比如在线热备份、行锁支持等。如果应用中需要执行大量的INSERT或UPDATE操作，使用它比较好，这样可以提高多用户并发操作的性能。

## MyISAM索引和InnoDB索引的区别

* MyISAM索引是非聚簇索引，而InnoDB是聚簇索引。
* MyISAM索引的叶子节点存储的是行数据地址，需要再寻址一次才能得到数据。
* InnoDB的主键索引的叶子节点存储的是行数据，因此主键索引非常高效。
* InnoDB的非主键索引的叶子节点存储的是主键和其他带索引的列数据，因此查询时做到覆盖索引非常高效。

## InnoDB的关键特性

* 插入缓冲（`Insert Buffer`）：对写索引做了优化, 但是索引具体起作用是在读数据的时候。
* 二次写（`Double Write`）：保证数据页的可靠性。
* 自适应哈希索引（`AHI`）：会监控对表上各索引页的查询，可以提升速度。
* 异步IO（`Sync IO`）：提高磁盘操作性能。
* 刷新邻接页：当刷新一个脏页时, InnoDB会检测该页所在的区, 并将该区下所有的脏页一起刷新。

## 存储引擎选择

主要从以下几个方面考虑：

* **事务**：需要事务支持，推荐InnoDB。
* **备份**：需要在线热备份，推荐InnoDB。
* **崩溃恢复**：MyISAM崩溃后发生损坏的概率比InnoDB高很多，而且恢复速度也很慢。
* **特有的特性**：比如只有MyISAM支持地理空间搜索。
