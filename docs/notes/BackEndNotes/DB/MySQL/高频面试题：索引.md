# 高频面试题：索引

## 什么是索引

* 索引是一种用于快速查询和检索数据的数据结构，需要占据物理空间，它们包含着对数据表所有记录的引用指针。常见的索引结构有: B树， B+树和Hash。
* 通俗的讲，索引就相当于书的目录，为了方便查找书中的内容，可以通过对内容建立索引形成目录。

## 索引有哪些优缺点

* 优点：
  * 可以大大加快数据的检索速度。
  * 可以帮助服务器避免排序和临时表。
  * 可以将随机IO变为顺序IO。
* 缺点：
  * 时间方面：创建索引和维护索引都需要耗费时间，当对表中的数据进行操作时，索引也需要动态的维护，这会降低操作的效率。
  * 空间方面：索引需要占据物理空间。

## 索引有哪几种类型

` show index from table_name; ` 查看索引

* 主键索引：数据列不能重复，不能为NULL，一个表只能有一个主键索引。
  * ` ALTER TABLE table_name ADD PRIMARY KEY(column); ` 创建主键索引
* 唯一索引：数据列不能重复，能为NULL，一个表可以有多个唯一索引。
  * ` ALTER TABLE table_name ADD UNIQUE(column); ` 创建唯一索引
  * ` ALTER TABLE table_name ADD UNIQUE(column1, column2); ` 创建唯一组合索引
* 普通索引：最基本的索引类型，没有什么特别的限制。
  * ` ALTER TABLE table_name ADD INDEX index_name(column); ` 创建普通索引
  * ` ALTER TABLE table_name ADD INDEX index_name(column1, colimn2); ` 创建普通组合索引
* 全文索引：目前搜索引擎关键的技术，MyISAM支持，InnoDB不支持。
  * ` ALTER TABLE table_name ADD FULLTEXT(column); ` 创建全文索引

## 索引的基本原理

* 原理很简单，就是把无序的数据变成有序的查询。
* 具体过程为，把创建了索引的列的内容进行排序，对排序结果生成倒排表，在倒排表上拼接上数据地址链。在查询的时候，先拿到倒排表内容，再取出数据地址链，从而拿到具体数据。

## 索引算法有哪些

* B树算法：它是最常用的MySQL数据库索引算法，也是默认的算法。它不仅可以用到 `= > => < <= between` 这些比较操作符上，还作用于 `LIKE` 操作符上。
* Hash算法：它只能用于对等比较。由于是一次定位数据。不需要像B树那样需要从根节点到子节点，所以可以减少IO访问，其效率高于B树。

## 索引创建的原则

* 遵循最左前缀原则。
* 被频繁查询的字段才去创建索引。
* 有外键的数据列一定要建立索引。

## 索引创建的注意点

* 适合创建索引的字段
  * 非空字段：应该指定列为 NOT ，在MySQL中，因为 NULL 需要更多的存储空间并且 NULL 无法参与某些运算。
  * 被频繁查询的字段。
  * 被作为条件查询的字段。
  * 被经常频繁用于连接的字段。
* 不适合创建索引的字段
  * 被频繁更新的字段。
  * 不被频繁查询的字段。

## 最左前缀原则和最左匹配原则

* 最左前缀原则：顾名思义，就是最左优先，在创建所列索引时，要根据业务需求，WHERE子句中使用最频繁的一列要放在最左边。
* 最左匹配原则：指的是MySQL会一直向右匹配直到遇到范围查询( `>、<、between、like` 等)就停止匹配。

## 索引的使用场景

* 在经常用到的条件字段中。
* 联结操作等。

## 索引失效的情况

* WHERE 字句的查询条件里有不等于号（WHERE column!=...），将无法使用索引。
* WHERE 字句的查询条件里使用了函数（如：WHERE DAY(column)=...），将无法使用索引。
* 在联结操作中，MySQL只有在主键和外键的数据类型相同时才使用索引，否则将无法使用索引。

## 为什么索引能提高查询速度

* 因为底层结构是B+树，可以把无序的数据变成有序的查询。

## 使用索引一定能提高查询的性能吗

* 大多数情况下，索引查询都是比全表扫描要快的。但是如果数据库的数据量不大，那么使用索引也不一定能够带来很大提升。

## 百万级别或以上的数据如何删除

* 根据索引的特性，在删除百万级别或以上的数据时，删除数据的速度和创建的索引数量成正比。
* 所以，首先可以先删除索引。
* 然后删除其中的无用数据。
* 删除完成后重新创建索引。
* 这样一般比直接删除要快的多，同时还保留回滚的可能性。

## 使用B树和B+树的好处

* B树中，可以将键和值存放在内部节点和叶子节点，而且叶子节点各自独立。因此，把频繁访问的数据放在靠近根节点的地方将会的大大提高数据的查询效率，使得B树适合在特定数据重复多次查询的场景。
* B+树中，内部节点都是键，没有值，叶子节点同时存放键和值，而且叶子节点有一条链相连。因此，一次读取可以在内存页中获取更多的键，有利于更快地缩小查找范围。

## Hash索引和B+树索引有什么区别和优劣

* Hash索引定位快，但是容易出现Hash冲突，并且Hash索引不支持顺序和范围查询。
* B+树索引是有序的，对于顺序和范围查询性能比较高。

## 什么是聚簇（集）索引，何时使用聚簇索引（优缺点）

* 聚集索引：索引结构和数据一起存放的索引，比如主键索引就属于聚集索引。
* 聚集索引的优点：它的查询速度非常快，因为B+树本身就是一个多叉平衡树，叶子节点也是有序的，定位到索引的节点，相当于定位了数据。
* 聚集索引的缺点：因为B+树本身就是一个多叉平衡树，所以依赖于有序的数据。因为数据修改对应的索引也需要修改，所以更新代价非常大。

## 什么是非聚簇索引，何时使用非聚簇索引（优缺点）

* 非聚集索引：索引结构和数据分开存放的索引。
* 非聚集索引的优点：更新代价小。
* 非聚集索引的缺点：它也依赖于有序的数据。而且当查到索引对应的指针或主键后，可能还需要根据指针或主键再到数据文件或表中查询，即二次查询（回表）。

## 非聚簇索引一定会回表查询吗（覆盖索引）

* 不一定，这涉及到查询语句所要求的字段是否全部命中了索引，如果全部命中，则没必要进行回表查询。主键索引本身的key就是主键，查到返回就行了，这种情况就称之为**覆盖索引**。

## 覆盖索引

* 覆盖索引：指的是如果一个索引包含（或者说覆盖）所有需要查询的字段的值。
* 覆盖索引即需要查询的字段正好是索引的字段，那么直接根据该索引，就可以查到数据，而无需回表查询。
